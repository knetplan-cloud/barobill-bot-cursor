# 바로빌 챗봇 지식베이스 관리 가이드

## 목차
1. [JSON 데이터 직접 관리 가이드](#json-데이터-직접-관리-가이드)
2. [챗봇 검색 엔진 구동원리 상세 가이드](#챗봇-검색-엔진-구동원리-상세-가이드)
3. [Admin 페이지 사용 가이드](#admin-페이지-사용-가이드)
4. [자주묻는질문(FAQ) 관리 가이드](#자주묻는질문faq-관리-가이드)
5. [상황별 Case 항목 작성 가이드](#상황별-case-항목-작성-가이드)
6. [어투별 답변 작성 가이드](#어투별-답변-작성-가이드)
7. [우선순위(Priority) 구동 방식 상세 설명](#우선순위priority-구동-방식-상세-설명)
8. [날짜 패턴 추출 및 신고 마감일 계산](#날짜-패턴-추출-및-신고-마감일-계산)
9. [검색 품질 향상 가이드 (Advanced)](#검색-품질-향상-가이드-advanced)
10. [답변 포맷팅 및 리치 콘텐츠 가이드](#답변-포맷팅-및-리치-콘텐츠-가이드)
11. [피드백 기능 사용 가이드](#피드백-기능-사용-가이드)
12. [전문적인 답변 작성 가이드](#전문적인-답변-작성-가이드)
13. [질문 리스트 기반 데이터 추가 가이드](#질문-리스트-기반-데이터-추가-가이드)
14. [개선점 및 향후 계획](#개선점-및-향후-계획)

---

## JSON 데이터 직접 관리 가이드

### 파일 위치
```
src/data/barobill-knowledge.json
```

### 기본 구조 이해

```json
{
  "metadata": {
    "version": "버전 번호",
    "updated_at": "업데이트 날짜",
    "description": "설명"
  },
  "synonyms": {
    "대표어": ["동의어1", "동의어2", "동의어3"]
  },
  "items": [
    {
      "id": "고유ID",
      "type": "intent | knowledge | case",
      "category": "카테고리명",
      "title": "질문 제목",
      "keywords": ["키워드1", "키워드2"],
      "priority": 1-10,
      "responses": {
        "formal": "격식체 답변",
        "casual": "해요체 답변",
        "informal": "반말 답변",
        "plain": "평어체 답변"
      }
    }
  ]
}
```

### JSON 필드 상세 정의

#### 1. `metadata` (메타데이터)
전체 지식베이스의 기본 정보를 담는 최상위 객체입니다.

| 필드 | 타입 | 필수 | 설명 | 예시 | 챗봇 사용 여부 |
|------|------|------|------|------|---------------|
| `version` | string | ✅ | 지식베이스 버전 번호 | `"2.1.0"` | ❌ 내부 데이터만 |
| `updated_at` | string | ✅ | 마지막 업데이트 날짜 | `"2025-11-14"` | ❌ 내부 데이터만 |
| `description` | string | ✅ | 지식베이스 설명 | `"바로빌 AI 통합 지식베이스 - 세금계산서 전문"` | ❌ 내부 데이터만 |

**역할**: 
- 버전 관리 및 변경 이력 추적
- 지식베이스의 전체적인 정보 제공
- **챗봇 검색 로직에는 사용되지 않음** (관리자용 메타데이터)

---

#### 2. `synonyms` (동의어 사전)
사용자가 다양한 표현으로 질문할 수 있도록 동의어를 정의하는 객체입니다.

**구조**:
```json
{
  "synonyms": {
    "대표어": ["동의어1", "동의어2", "동의어3"]
  }
}
```

**예시**:
```json
{
  "synonyms": {
    "세금계산서": ["세계서", "계산서", "전자세금계산서", "전세계"],
    "발급": ["발행", "작성", "만들기", "생성"],
    "환입": ["반품", "환불", "리턴", "반환"]
  }
}
```

**역할**:
- 검색 엔진이 다양한 표현을 인식하도록 확장
- 오타나 비표준 표현도 매칭 가능
- 예: "세계서" → "세금계산서"로 자동 변환

**챗봇 사용 여부**: ✅ **검색 로직에 사용됨**
- 질문 확장 단계에서 동의어 사전을 참조하여 검색 키워드를 확장

**작성 팁**:
- 자주 틀리는 오타 포함 (예: "세계서", "전세계")
- 비즈니스 용어의 다양한 표현 포함
- 줄임말 포함 (예: "현영" → "현금영수증")

---

#### 3. `items` (질문-답변 항목 배열)
실제 챗봇이 사용하는 질문-답변 데이터의 배열입니다.

##### 3.1 기본 필드

| 필드 | 타입 | 필수 | 설명 | 예시 | 챗봇 사용 여부 |
|------|------|------|------|------|---------------|
| `id` | string | ✅ | 고유 식별자 | `"knowledge_tax_issuance"` | ❌ 내부 데이터만 |
| `type` | string | ✅ | 항목 유형 | `"intent"`, `"knowledge"`, `"case"`, `"faq"`, `"error"` | ❌ 내부 데이터만 (필터링용) |
| `category` | string | ✅ | 카테고리명 | `"세금계산서"`, `"수정세금계산서"` | ❌ 내부 데이터만 (관리용) |
| `title` | string | ✅ | 질문 제목 | `"세금계산서 발급 방법"` | ✅ **검색 로직 사용** (+20점) |
| `description` | string | ❌ | 상세 설명 | `"세금계산서 발급 절차 안내"` | ❌ 내부 데이터만 (관리자용) |
| `keywords` | string[] | ✅ | 검색 키워드 배열 | `["세금계산서", "발급", "방법"]` | ✅ **검색 로직 사용** (+10점/개) |
| `priority` | number | ✅ | 우선순위 (1-10) | `5` | ✅ **검색 로직 사용** (값 그대로 추가) |

**`type` 필드 상세**:
- `"intent"`: 인사말, 자기소개 등 (우선순위 10)
- `"knowledge"`: 일반 지식, 개념 설명 (우선순위 5-6)
- `"case"`: 상황별 문제 해결 (우선순위 7-9)
- `"faq"`: FAQ 항목 (통합 검색용, 우선순위 6-7)
- `"error"`: 오류 메시지/문제 해결 (우선순위 9)

##### 3.2 고급 필드

| 필드 | 타입 | 필수 | 설명 | 예시 | 챗봇 사용 여부 |
|------|------|------|------|------|---------------|
| `negativeKeywords` | string[] | ❌ | 제외 키워드 | `["취소", "수정", "반품"]` | ✅ **검색 로직 사용** (매칭 시 즉시 탈락) |
| `dateTemplate` | boolean | ❌ | 날짜 템플릿 여부 | `true` | ✅ **검색 로직 사용** (+15점 보너스) |
| `relatedGuides` | object[] | ❌ | 관련 가이드 링크 | 아래 참조 | ✅ **출력에 사용** (답변 하단 표시) |
| `relatedQuestions` | string[] | ❌ | 관련 질문 목록 | `["세금계산서 수정은?", "부가세 신고는?"]` | ✅ **출력에 사용** (답변 하단 표시) |
| `followUpQuestions` | string[] | ❌ | 후속 질문 목록 | `["더 자세히 알려주세요"]` | ✅ **출력에 사용** (답변 하단 표시) |

**`negativeKeywords` (제외 키워드)**:
- 이 키워드가 질문에 포함되면 해당 항목이 선택되지 않음
- 예: "세금계산서 발급 방법" 항목에 `negativeKeywords: ["취소", "수정"]` 설정
  - "세금계산서 발급 방법" → ✅ 매칭
  - "세금계산서 취소 방법" → ❌ 매칭 안 됨

**`dateTemplate` (날짜 템플릿)**:
- 날짜가 포함된 질문에 대응하는 템플릿 항목
- `true`로 설정 시 날짜 추출 및 신고 마감일 계산 활성화
- 답변에 `{date}`, `{deadline}`, `{today}` 동적 변수 사용 가능

**`relatedGuides` (관련 가이드)**:
```json
{
  "relatedGuides": [
    {
      "title": "발급 가이드 보러가기",
      "url": "https://www.barobill.co.kr/guide/issue",
      "icon": "📘"
    }
  ]
}
```

##### 3.3 `responses` (답변 객체)

| 필드 | 타입 | 필수 | 설명 | 예시 | 챗봇 사용 여부 |
|------|------|------|------|------|---------------|
| `formal` | string | ✅ | 격식체 답변 | `"세금계산서 발급은..."` | ✅ **출력에 사용** (어투별 선택) |
| `casual` | string | ❌ | 해요체 답변 | `"세금계산서 발급? ..."` | ✅ **출력에 사용** (어투별 선택) |
| `plain` | string | ❌ | 평어체 답변 | `"세금계산서 발급은..."` | ✅ **출력에 사용** (어투별 선택) |

**답변 작성 가이드**:
- `formal`: 공식적인 비즈니스 상황에 적합 (~입니다, ~하십시오)
- `casual`: 친근하고 부드러운 존댓말 (~에요, ~해요, 이모지 활용)
- `plain`: 간결하고 설명적인 톤 (~함, ~임, ~됨)

**동적 변수 사용** (날짜 템플릿 항목):
- `{date}`: 추출된 날짜 (예: "2025년 11월 20일")
- `{deadline}`: 계산된 신고 마감일 (예: "2026년 1월 25일")
- `{today}`: 오늘 날짜 (예: "2025년 11월 14일")

### 항목 추가 방법

#### 1. 새 항목 추가 예시

```json
{
  "id": "case_return_2025_11_20",
  "type": "case",
  "category": "수정세금계산서",
  "title": "2025년 11월 20일 거래분 반품 처리",
  "keywords": ["2025년 11월 20일", "11월 20일", "반품", "환입"],
  "priority": 9,
  "responses": {
    "formal": "2025년 11월 20일자 세금계산서의 경우...",
    "casual": "2025년 11월 20일에 끊은 거지? 신고 기간 아직 안 지났으면...",
    "informal": "2025년 11월 20일에 끊은 거야? 신고 기간 아직 안 지났으면...",
    "plain": "2025년 11월 20일 거래분의 경우, 신고 마감 전이라면..."
  }
}
```

---

## Admin 페이지 사용 가이드

### 접근 방법

1. **웹 브라우저에서 직접 접근:**
   ```
   http://localhost:8080/admin
   ```
   또는
   ```
   https://your-domain.com/admin
   ```

2. **메인 페이지에서 접근:**
   - 메인 페이지 우측 하단의 "지식베이스 관리" 버튼 클릭

### 주요 기능

#### 1. 항목 추가
- "새 항목 추가" 버튼 클릭
- **필수 항목 입력:**
  - 유형 (Intent/Knowledge/Case)
  - 카테고리
  - 제목
  - Formal 답변
- **선택 항목:**
  - 설명
  - 우선순위 (1-10)
  - 키워드
  - Casual/Informal/Plain 답변

#### 2. 항목 수정
- 항목 목록에서 수정할 항목 찾기
- 연필 아이콘 클릭
- 내용 수정 후 "저장" 클릭

#### 3. 항목 삭제
- 항목 목록에서 삭제할 항목 찾기
- 휴지통 아이콘 클릭
- 확인 대화상자에서 "확인" 클릭

#### 4. JSON 다운로드
- "JSON 다운로드" 버튼 클릭
- 수정된 내용이 포함된 JSON 파일 다운로드
- 파일명: `barobill-knowledge-YYYY-MM-DD.json`

#### 5. 검색 및 필터
- **검색창:** 제목이나 키워드로 검색
- **유형 필터:** Intent/Knowledge/Case 선택

---

## 자주묻는질문(FAQ) 관리 가이드

### 파일 위치
```
src/data/barobill-faq.json
```

### FAQ JSON 구조

FAQ는 챗봇 지식베이스와 별도로 관리되는 독립적인 JSON 파일입니다.

```json
{
  "metadata": {
    "version": "1.0.0",
    "updated_at": "2025-11-14",
    "description": "바로빌 자주묻는질문 (FAQ)"
  },
  "categories": [
    "세금계산서",
    "인증서등록",
    "바로빌서비스",
    "세무정보"
  ],
  "items": [
    {
      "id": "faq_tax_issuance",
      "question": "세금계산서 발급 방법은?",
      "category": "세금계산서",
      "order": 1,
      "content": [
        {
          "type": "text",
          "content": "세금계산서 발급은 [매출문서 작성] 메뉴에서 가능합니다.\n\n다음 단계를 따라주세요:"
        },
        {
          "type": "image",
          "src": "/faq-images/tax-issuance-menu.png",
          "alt": "매출문서 작성 메뉴 화면",
          "caption": "바로빌 메인 화면에서 '매출문서 작성' 메뉴를 선택하세요"
        },
        {
          "type": "text",
          "content": "**1단계: 로그인 및 메뉴 선택**\n\n바로빌에 로그인한 후, 좌측 메뉴에서 '세금계산서 발급'을 클릭합니다."
        }
      ],
      "relatedGuides": [
        {
          "title": "발급 가이드 보러가기",
          "url": "https://www.barobill.co.kr/guide/issue",
          "icon": "📘"
        }
      ],
      "relatedKnowledgeId": "knowledge_tax_issuance"
    }
  ]
}
```

### FAQ 필드 상세 정의

| 필드 | 타입 | 필수 | 설명 | 예시 |
|------|------|------|------|------|
| `id` | string | ✅ | 고유 식별자 | `"faq_tax_issuance"` |
| `question` | string | ✅ | 질문 내용 | `"세금계산서 발급 방법은?"` |
| `category` | string | ✅ | 카테고리 | `"세금계산서"` |
| `order` | number | ❌ | 표시 순서 | `1` |
| `content` | object[] | ❌ | 콘텐츠 배열 (텍스트+이미지 교차 배치) | 아래 참조 |
| `answer` | string | ❌ | 답변 내용 (하위 호환성) | `"세금계산서 발급은..."` |
| `images` | object[] | ❌ | 이미지 배열 (하위 호환성) | 아래 참조 |
| `relatedGuides` | object[] | ❌ | 관련 가이드 링크 | 아래 참조 |
| `relatedKnowledgeId` | string | ❌ | 챗봇 지식베이스 연결 | `"knowledge_tax_issuance"` |

**`relatedGuides` (관련 가이드)**:
```json
{
  "relatedGuides": [
    {
      "title": "발급 가이드 보러가기",
      "url": "https://www.barobill.co.kr/guide/issue",
      "icon": "📘"
    }
  ]
}
```

**`images` (이미지 배열)**:
```json
{
  "images": [
    {
      "src": "/faq-images/tax-issuance-step1.png",
      "alt": "세금계산서 발급 메뉴 화면",
      "caption": "매출문서 작성 메뉴에서 세금계산서 발급을 선택하세요"
    },
    {
      "src": "/faq-images/tax-issuance-step2.png",
      "alt": "공급받는자 정보 입력 화면",
      "caption": "사업자번호와 상호명을 입력하세요"
    }
  ]
}
```

**이미지 필드 설명**:
- `src`: 이미지 경로 (public 폴더 기준, `/faq-images/파일명` 형식)
- `alt`: 이미지 대체 텍스트 (접근성)
- `caption`: 이미지 하단에 표시될 설명 (선택)

**이미지 디렉토리 구조**:
```
public/
  └── faq-images/
      ├── tax-issuance-step1.png
      ├── tax-issuance-step2.png
      └── certificate-register.png
```

**`content` (콘텐츠 배열 - 텍스트와 이미지 교차 배치)**:
```json
{
  "content": [
    {
      "type": "text",
      "content": "세금계산서 발급은 [매출문서 작성] 메뉴에서 가능합니다."
    },
    {
      "type": "image",
      "src": "/faq-images/tax-issuance-menu.png",
      "alt": "매출문서 작성 메뉴 화면",
      "caption": "바로빌 메인 화면에서 '매출문서 작성' 메뉴를 선택하세요"
    },
    {
      "type": "text",
      "content": "**1단계: 로그인 및 메뉴 선택**\n\n바로빌에 로그인한 후, 좌측 메뉴에서 '세금계산서 발급'을 클릭합니다."
    }
  ]
}
```

**콘텐츠 블록 타입**:
- `type: "text"`: 텍스트 블록 (Markdown 지원: `**굵게**`, `[메뉴명]` 등)
- `type: "image"`: 이미지 블록
  - `src`: 이미지 경로 (`/faq-images/파일명`)
  - `alt`: 대체 텍스트 (접근성)
  - `caption`: 이미지 하단 설명 (선택)

**이미지 정렬**: 기본적으로 좌측 정렬됩니다.

**`relatedKnowledgeId` (챗봇 지식베이스 연결)**:
- FAQ 항목과 챗봇 지식베이스 항목을 연결하는 ID
- 챗봇에서 더 자세한 정보를 제공할 때 사용
- 선택 사항이지만 연결 시 일관성 유지에 도움

### FAQ 항목 추가 방법

#### 1. 새 FAQ 항목 추가 예시

```json
{
  "id": "faq_new_item",
  "question": "새로운 질문은?",
  "answer": "답변 내용을 작성하세요.\n\n**중요한 내용**은 굵은 글씨로 표시할 수 있습니다.\n\n[메뉴명]은 파란색으로 강조됩니다.",
  "category": "세금계산서",
  "order": 10,
  "images": [
    {
      "src": "/faq-images/new-item-screenshot.png",
      "alt": "새 항목 화면 캡처",
      "caption": "화면에서 해당 메뉴를 찾을 수 있습니다"
    }
  ],
  "relatedGuides": [
    {
      "title": "상세 가이드",
      "url": "https://www.barobill.co.kr/guide",
      "icon": "📘"
    }
  ],
  "relatedKnowledgeId": "knowledge_new_item"
}
```

#### 2. FAQ 작성 팁

**질문 작성**:
- 사용자가 실제로 검색할 만한 자연스러운 질문
- 간결하고 명확하게
- 예: "세금계산서 발급 방법은?" ✅
- 예: "세금계산서" ❌ (너무 짧음)

**답변 작성**:
- FAQ는 간단한 요약 버전
- 챗봇 지식베이스는 상세한 정보 제공
- Markdown 문법 사용 가능:
  - `**굵은 글씨**` → **굵은 글씨**
  - `[메뉴명]` → 파란색 강조
- 줄바꿈은 `\n` 사용

**카테고리 선택**:
- `categories` 배열에 정의된 카테고리만 사용
- 현재 지원 카테고리:
  - `세금계산서`
  - `인증서등록`
  - `바로빌서비스`
  - `세무정보`

**순서(order) 설정**:
- 숫자가 작을수록 먼저 표시
- 같은 카테고리 내에서 정렬에 사용
- 생략 시 추가된 순서대로 표시

### FAQ와 챗봇 지식베이스의 차이

| 항목 | FAQ | 챗봇 지식베이스 |
|------|-----|----------------|
| **목적** | 사용자가 직접 찾아보는 정적 정보 | 대화형 매칭을 위한 동적 정보 |
| **구조** | 간단 (질문-답변) | 복잡 (키워드, 우선순위, 어투별 답변) |
| **답변** | 1개 (간단 요약) | 3개 (formal, casual, plain) |
| **관리** | FAQ 전용 | 챗봇 전용 |
| **연결** | `relatedKnowledgeId`로 연결 가능 | 독립적 |

### FAQ 카테고리 관리

**새 카테고리를 추가하려면:**

1. `categories` 배열에 추가:
   ```json
   {
     "categories": [
       "세금계산서",
       "인증서등록",
       "바로빌서비스",
       "세무정보",
       "새카테고리"  // 추가
     ]
   }
   ```

2. FAQ 항목의 `category` 필드에 새 카테고리명 사용

3. FAQ 섹션의 탭에 자동으로 추가됨

### FAQ 관리 워크플로우

#### 방법 1: JSON 파일 직접 편집 (권장)

```bash
# 1. src/data/barobill-faq.json 파일 열기
# 2. items 배열에 새 항목 추가
# 3. 저장 후 개발 서버 자동 반영
```

#### 방법 2: Admin 페이지에서 관리 (향후 추가 예정)

- FAQ 전용 관리 페이지 추가 예정
- 현재는 JSON 파일 직접 편집 권장

### FAQ 이미지 사용 가이드

#### 1. 이미지 파일 준비

**지원 형식**: PNG, JPG, JPEG, SVG, WebP

**권장 사양**:
- 해상도: 최소 800px 너비
- 파일 크기: 500KB 이하 (로딩 속도 고려)
- 형식: PNG (스크린샷), JPG (사진), SVG (아이콘)

#### 2. 이미지 파일 저장

1. 이미지 파일을 `public/faq-images/` 디렉토리에 저장
2. 파일명은 의미있게 작성 (예: `tax-issuance-step1.png`)
3. 경로는 `/faq-images/파일명` 형식으로 사용

**예시**:
```
public/faq-images/
  ├── tax-issuance-step1.png
  ├── tax-issuance-step2.png
  ├── certificate-register.png
  └── service-signup.png
```

#### 3. JSON에 이미지 추가

```json
{
  "images": [
    {
      "src": "/faq-images/tax-issuance-step1.png",
      "alt": "세금계산서 발급 메뉴 화면",
      "caption": "매출문서 작성 메뉴에서 세금계산서 발급을 선택하세요"
    }
  ]
}
```

**이미지 작성 팁**:
- `alt` 텍스트는 시각 장애인을 위한 대체 텍스트로 필수
- `caption`은 이미지 하단에 표시되는 설명 (선택)
- 여러 단계가 있으면 여러 이미지를 순서대로 추가
- 이미지는 답변 텍스트 아래에 표시됨

#### 4. 이미지 최적화

**권장 도구**:
- [TinyPNG](https://tinypng.com/) - PNG/JPG 압축
- [Squoosh](https://squoosh.app/) - 이미지 최적화
- [ImageOptim](https://imageoptim.com/) - 일괄 최적화

**최적화 팁**:
- 스크린샷: PNG → WebP 변환 고려
- 사진: JPG 품질 80-85% 권장
- 아이콘: SVG 사용 권장

### FAQ 작성 체크리스트

- [ ] `id`가 고유한가?
- [ ] `question`이 명확하고 자연스러운가?
- [ ] `answer`가 충분히 설명하는가? (최소 50자 이상)
- [ ] `category`가 `categories` 배열에 포함되어 있는가?
- [ ] `order`가 적절한가? (같은 카테고리 내 순서)
- [ ] `images`가 있다면:
  - [ ] 이미지 파일이 `public/faq-images/`에 존재하는가?
  - [ ] `src` 경로가 `/faq-images/파일명` 형식인가?
  - [ ] `alt` 텍스트가 명확한가?
- [ ] `relatedGuides`가 있다면 URL이 유효한가?
- [ ] `relatedKnowledgeId`가 있다면 챗봇 지식베이스에 존재하는가?

---

## 상황별 Case 항목 작성 가이드

### 날짜 패턴 인식

다양한 날짜 표현을 키워드에 포함:

```json
"keywords": [
  "2025년 10월 16일",
  "10월 16일",
  "2025-10-16",
  "2025/10/16",
  "10.16"
]
```

### Examples 필드 활용

구체적 상황 예시 추가:

```json
"examples": [
  {
    "situation": "2025년 10월 16일 거래분 전액 반품",
    "solution": "수정세금계산서 > 환입 사유 선택 > 반품 금액 입력",
    "dateContext": "2025-10-16",
    "deadline": "2026-01-25"
  },
  {
    "situation": "2025년 10월 16일 거래분 일부(50만원) 반품",
    "solution": "수정세금계산서 > 환입 사유 선택 > 50만원만 입력"
  }
]
```

---

## 어투별 답변 작성 가이드

### Formal (격식체)
- **특징:** 존댓말, 격식 있는 표현
- **예시:** "~입니다", "~하십시오", "~하시면 됩니다"
- **사용 예:**
  ```
  "2025년 10월 16일자 세금계산서의 경우, 해당 세금 신고 마감기한이 지나지 않았다면 [환입] 사유로 수정세금계산서를 발행하시면 됩니다."
  ```

### Casual (해요체)
- **특징:** 친근한 존댓말
- **예시:** "~에요", "~해요", "~돼요", "~거예요"
- **사용 예:**
  ```
  "2025년 10월 16일에 끊은 거지? 신고 기간 아직 안 지났으면 [환입]으로 다시 끊으면 돼요! 🧾"
  ```

### Informal (반말)
- **특징:** 친근한 반말
- **예시:** "~야", "~해", "~돼", "~거야"
- **사용 예:**
  ```
  "2025년 10월 16일에 끊은 거야? 신고 기간 아직 안 지났으면 [환입]으로 다시 끊으면 돼! 🧾"
  ```

### Plain (평어체)
- **특징:** 설명조, 간결한 표현
- **예시:** "~함", "~임", "~됨", "~거임"
- **사용 예:**
  ```
  "2025년 10월 16일 거래분의 경우, 신고 마감 전이라면 [환입] 수정세금계산서 발급 대상임."
  ```

---

## 우선순위(Priority) 설정 가이드

- **10:** 인사/자기소개 (Intent)
- **9:** 중요한 상황별 Case (예: 특정 날짜 반품 처리)
- **8:** 일반적인 Case 또는 중요한 FAQ
- **7:** 일반적인 Case
- **5-6:** 일반적인 Knowledge
- **4:** 서비스 안내

---

## 챗봇 검색 엔진 구동원리 상세 가이드

### 전체 작동 순서

```
1. 질문 접수 → 2. 질문 정규화 → 3. 동의어 확장 → 4. 후보 탐색 (점수 계산) 
→ 5. 임계점 체크 → 6. 어투 적용 → 7. 동적 변수 치환 → 8. 최종 출력
```

### 단계별 상세 설명

#### 1단계: 질문 접수
사용자가 질문을 입력합니다.
- 예: "세금계산서 취소 방법 알려줘"

#### 2단계: 질문 정규화 (normalizeText)
질문을 검색하기 쉬운 형태로 변환합니다.
- 띄어쓰기 제거
- 소문자 변환
- 특수문자 제거 (`,`, `.`, `?`, `!`, `~` 등)
- 예: "세금계산서 취소 방법 알려줘" → "세금계산서취소방법알려줘"

#### 3단계: 동의어 확장 (getExpandedKeywords)
`synonyms` 사전을 참고하여 검색어를 확장합니다.
- 질문에 포함된 단어의 동의어를 모두 추가
- 예: "취소" → ["취소", "해제", "철회", "삭제"]
- 최종 확장 키워드: ["세금계산서취소방법알려줘", "세금계산서", "취소", "해제", "철회", "삭제", ...]

#### 4단계: 후보 탐색 및 점수 계산
`items` 배열의 각 항목에 대해 점수를 계산합니다.

**점수 계산 공식:**
```
최종 점수 = (키워드 매칭 점수) + (제목 매칭 점수) + (우선순위) + (날짜 템플릿 보너스)
```

**점수 계산 상세:**

1. **Negative Keywords 체크 (최우선)**
   - 항목의 `negativeKeywords`에 질문의 키워드가 포함되어 있으면 **즉시 탈락 (0점)**
   - 예: "세금계산서 발급 방법" 항목에 `negativeKeywords: ["취소"]`가 있고, 질문에 "취소"가 포함되면 → 탈락

2. **키워드 매칭 점수**
   - **점수:** 매칭된 키워드 1개당 **+10점**
   - **동작:** 확장된 질문 키워드가 항목의 `keywords` 배열에 포함되어 있는지 확인
   - **예시:** 
     - 질문: "세금계산서 취소 방법"
     - 항목 keywords: ["세금계산서", "취소", "방법"]
     - 매칭: "세금계산서" (10점) + "취소" (10점) + "방법" (10점) = **30점**

3. **날짜 키워드 매칭 (날짜가 추출된 경우)**
   - 날짜가 추출되면 날짜 관련 키워드 매칭 시 **+10점** 추가
   - `dateTemplate: true`인 항목은 **+15점** 추가 보너스
   - 예: "2025년 11월 20일자 세금계산서" 질문 시 날짜 템플릿 항목에 가산점

4. **제목(Title) 정확도 가산점**
   - **점수:** 질문이 제목을 직접 포함하면 **+20점**
   - **동작:** 정규화된 질문에 정규화된 제목이 포함되어 있는지 확인
   - **예시:**
     - 질문: "세금계산서 취소 방법"
     - 제목: "세금계산서 취소 방법"
     - 매칭: **+20점**

5. **우선순위(Priority) 가산점**
   - **점수:** Priority 값 그대로 추가 (1-10점)
   - **동작:** `priority` 필드의 값이 그대로 점수에 추가됨
   - **예시:**
     - Priority 9 → **+9점**
     - Priority 5 → **+5점**

#### 5단계: 임계점(Threshold) 체크
- **최종 점수가 15점 미만이면:** AI로 위임
- **15점 이상이면:** 해당 답변 반환

#### 6단계: 어투 적용
- 사용자가 설정한 어투(`formal`, `casual`, `plain`)에 맞는 답변 선택
- 해당 어투의 답변이 없으면 `formal`을 기본값으로 사용

#### 7단계: 동적 변수 치환
- `{date}` → 추출된 날짜 (예: "2025년 11월 20일")
- `{deadline}` → 신고 마감일 (예: "2026년 1월 25일")
- `{today}` → 오늘 날짜

#### 8단계: 최종 출력
- 답변 텍스트
- 관련 가이드 링크 (`relatedGuides`)
- 후속 질문 (`followUpQuestions`)
- 관련 질문 (`relatedQuestions`)

---

## 우선순위(Priority) 구동 방식 상세 설명

### 점수 계산 공식

챗봇은 사용자의 질문과 지식베이스 항목을 매칭할 때 다음 공식을 사용합니다:

```
최종 점수 = (키워드 매칭 점수) + (제목 매칭 점수) + (우선순위) + (날짜 템플릿 보너스)
```

### 상세 계산 방식

#### 1. Negative Keywords 체크 (최우선)
- **점수:** 매칭 시 **즉시 탈락 (0점)**
- **동작 방식:**
  - 항목의 `negativeKeywords` 배열에 질문의 키워드가 포함되어 있으면 해당 항목 제외
  - 확장된 동의어도 체크됨
  - 예: "세금계산서 발급 방법" 항목에 `negativeKeywords: ["취소"]`가 있고, 질문에 "취소"가 포함되면 → 탈락

#### 2. 키워드 매칭 점수
- **점수:** 매칭된 키워드 1개당 **+10점**
- **동작 방식:**
  - 확장된 질문 키워드가 항목의 `keywords` 배열에 포함되어 있는지 확인
  - 동의어(synonyms) 확장도 적용됨
  - 예: 질문에 "반품"이 있고, 항목의 keywords에 "반품", "환입"이 있으면 → 20점

#### 3. 날짜 키워드 매칭 (날짜가 추출된 경우)
- **점수:** 날짜 관련 키워드 매칭 시 **+10점** (키워드 매칭과 별도)
- **날짜 템플릿 보너스:** `dateTemplate: true`인 항목은 **+15점** 추가
- **동작 방식:**
  - 질문에서 날짜가 추출되면 (예: "2025년 11월 20일")
  - 날짜 관련 키워드 매칭 시 추가 점수 부여
  - `dateTemplate: true`인 항목은 추가 보너스 점수

#### 4. 제목(Title) 정확도 가산점
- **점수:** 질문이 제목을 직접 포함하면 **+20점**
- **동작 방식:**
  - 정규화된 질문에 정규화된 제목이 포함되어 있으면 가산점 부여
  - 예: 질문 "세금계산서 발급 방법" → 제목 "세금계산서 발급 방법"과 일치 → 20점

#### 5. 우선순위(Priority) 가산점
- **점수:** Priority 값 그대로 가산점으로 추가 (1-10점)
- **동작 방식:**
  - Priority가 9인 항목은 9점 추가
  - Priority가 5인 항목은 5점 추가
  - **중요:** Priority만으로는 통과할 수 없음 (최소 15점 필요)

### 점수 계산 예시

**질문:** "2025년 11월 20일 거래분 반품 처리 어떻게 해?"

#### 항목 A: "반품(환입)에 의한 수정세금계산서" (priority: 8)
- 키워드 매칭: "반품" (10점) + "환입" (10점) = **20점**
- 제목 매칭: 없음 = **0점**
- 우선순위: **8점**
- **총점: 28점**

#### 항목 B: "2025년 11월 20일 거래분 반품 처리" (priority: 9)
- 키워드 매칭: "2025년 11월 20일" (10점) + "11월 20일" (10점) + "반품" (10점) = **30점**
- 제목 매칭: "반품 처리" 포함 = **20점**
- 우선순위: **9점**
- **총점: 59점** → **선택됨! ✅**

### 우선순위의 역할

**Priority는 가산점으로 작동합니다:**
- 키워드 매칭 점수와 함께 합산되어 최종 점수를 결정
- 동일한 키워드 매칭 점수라면 Priority가 높은 항목이 선택됨

**예시:**
- 항목 A: 키워드 20점 + Priority 5 = **25점**
- 항목 B: 키워드 20점 + Priority 9 = **29점** → 항목 B 선택

### 임계점(Threshold)

**최종 점수가 15점 미만이면 AI로 넘깁니다:**
- 키워드 매칭이 거의 없거나 우선순위만으로는 통과 불가
- 15점 이상이어야 로컬 지식베이스에서 답변 제공
- 15점 미만이면 외부 AI(Gemini)로 질문 전달

### 우선순위 설정 전략

1. **최고 우선순위(10):**
   - 인사/자기소개 (intent)
   - 긴급 오류 메시지 (error)

2. **높은 우선순위(8-9):**
   - 구체적인 상황별 Case (날짜 포함 등)
   - 오류 해결 방법 (error)
   - 중요한 FAQ (faq)

3. **중간 우선순위(6-7):**
   - 일반적인 Case
   - 중요한 일반 지식 (knowledge)
   - 일반 FAQ (faq)

4. **낮은 우선순위(4-5):**
   - 일반적인 Knowledge
   - 서비스 안내

**팁:** 구체적이고 중요한 항목일수록 높은 우선순위를 부여하세요.

---

## 챗봇 참조 필드 정리

### 검색 로직에 사용되는 필드 (점수 계산)

| 필드 | 점수 | 설명 |
|------|------|------|
| `keywords` | +10점/개 | 확장된 질문 키워드가 포함되어 있으면 매칭당 10점 |
| `title` | +20점 | 질문이 제목을 직접 포함하면 20점 |
| `priority` | +1~10점 | Priority 값 그대로 추가 |
| `dateTemplate` | +15점 | 날짜가 추출되고 `dateTemplate: true`이면 추가 보너스 |
| `negativeKeywords` | 즉시 탈락 | 질문에 제외 키워드가 포함되면 0점 (탈락) |

### 출력에 사용되는 필드 (점수 계산 없음)

| 필드 | 설명 |
|------|------|
| `responses` | 어투별 답변 텍스트 (formal, casual, plain) |
| `relatedGuides` | 답변 하단에 표시될 관련 가이드 링크 |
| `relatedQuestions` | 답변 하단에 표시될 관련 질문 목록 |
| `followUpQuestions` | 답변 하단에 표시될 후속 질문 목록 |

### 내부 데이터로만 사용되는 필드 (검색/출력 미사용)

| 필드 | 용도 |
|------|------|
| `id` | 항목 식별용 (관리자 페이지에서 사용) |
| `type` | 항목 분류용 (관리자 페이지 필터링용) |
| `category` | 항목 분류용 (관리자 페이지 필터링용) |
| `description` | 관리자가 항목을 이해하기 위한 설명 |

### 필드 사용 요약표

| 필드 | 검색 로직 | 출력 | 내부 데이터 | 비고 |
|------|----------|------|------------|------|
| `keywords` | ✅ (+10점/개) | ❌ | ❌ | **가장 중요** |
| `title` | ✅ (+20점) | ❌ | ❌ | **중요** |
| `priority` | ✅ (+1~10점) | ❌ | ❌ | **중요** |
| `negativeKeywords` | ✅ (탈락) | ❌ | ❌ | **중요** |
| `dateTemplate` | ✅ (+15점) | ❌ | ❌ | 날짜 질문용 |
| `responses` | ❌ | ✅ | ❌ | 최종 출력 |
| `relatedGuides` | ❌ | ✅ | ❌ | 답변 하단 표시 |
| `relatedQuestions` | ❌ | ✅ | ❌ | 답변 하단 표시 |
| `followUpQuestions` | ❌ | ✅ | ❌ | 답변 하단 표시 |
| `id` | ❌ | ❌ | ✅ | 식별용 |
| `type` | ❌ | ❌ | ✅ | 분류용 |
| `category` | ❌ | ❌ | ✅ | 분류용 |
| `description` | ❌ | ❌ | ✅ | 설명용 |

---

## 키워드 작성 팁

### 1. 다양한 표현 포함
```json
"keywords": ["반품", "환불", "환입", "리턴", "반환", "취소"]
```

### 2. 날짜 패턴 포함
```json
"keywords": ["2025년 10월 16일", "10월 16일", "2025-10-16"]
```

### 3. 관련 용어 포함
```json
"keywords": ["수정세금계산서", "수정발급", "수정사유", "마이너스"]
```

---

## 작업 체크리스트

### JSON 파일 수정 시
- [ ] JSON 문법 오류 확인
- [ ] 모든 필수 필드 입력 확인
- [ ] 키워드 다양성 확인
- [ ] 어투별 답변 작성 확인
- [ ] 우선순위 적절성 확인

### Admin 페이지에서 작업 시
- [ ] 변경사항 저장 확인
- [ ] JSON 다운로드로 백업
- [ ] 로컬 서버에서 테스트
- [ ] 챗봇 답변 확인

---

## 문제 해결

### JSON 문법 오류
- JSON 파일을 JSONLint 등으로 검증
- 쉼표(,) 누락 확인
- 따옴표(") 확인

### 챗봇이 답변을 못 찾는 경우
- 키워드 추가 확인
- 우선순위 확인
- 키워드 매칭 점수 확인 (15점 이상 필요)

### FAQ에 표시되지 않는 경우
- `type`이 `"knowledge"` 또는 `"case"`인지 확인
- `category` 필드 확인

---

## 날짜 패턴 추출 및 신고 마감일 계산

### 날짜 패턴 자동 인식

챗봇은 질문에서 날짜를 자동으로 추출하여 답변에 활용합니다.

#### 지원하는 날짜 형식

1. **완전한 날짜 형식:**
   - `2025년 11월 20일`
   - `2025-11-20`
   - `2025/11/20`

2. **월일만 있는 형식 (년도 자동 추정):**
   - `11월 20일` → 현재 년도로 자동 추정
   - `11.20`

3. **상대적 날짜 (향후 지원 예정):**
   - `오늘`, `어제`, `지난주` 등

### 날짜 기반 신고 마감일 계산

부가가치세 신고 마감일은 거래일 기준으로 자동 계산됩니다:

- **1~6월 거래:** 해당 년도 **7월 25일**까지 신고
- **7~12월 거래:** 다음 해 **1월 25일**까지 신고

**예시:**
- 2025년 11월 20일 거래 → 신고 마감일: **2026년 1월 25일**
- 2025년 3월 15일 거래 → 신고 마감일: **2025년 7월 25일**

### JSON에서 날짜 템플릿 사용

날짜가 포함된 질문에 대응하려면 템플릿 방식으로 항목을 작성하세요:

```json
{
  "id": "case_return_date_template",
  "type": "case",
  "category": "수정세금계산서",
  "title": "특정 날짜 거래분 반품 처리",
  "keywords": [
    "반품",
    "환입",
    "거래일",
    "거래분"
  ],
  "dateTemplate": true,
  "priority": 9,
  "responses": {
    "formal": "{date}자 세금계산서의 경우, 해당 세금 신고 마감기한({deadline})이 지나지 않았다면 [환입] 사유로 수정세금계산서를 발행하시면 됩니다.",
    "casual": "{date}에 끊은 거지? 신고 기간({deadline}) 아직 안 지났으면 [환입]으로 다시 끊으면 돼! 🧾"
  }
}
```

### 동적 변수

답변 텍스트에서 다음 변수를 사용할 수 있습니다:

- `{date}`: 추출된 날짜 (예: "2025년 11월 20일")
- `{deadline}`: 계산된 신고 마감일 (예: "2026년 1월 25일")
- `{today}`: 오늘 날짜 (예: "2025년 1월 15일")

### 날짜 패턴 추측 기능

불완전한 날짜 정보도 처리합니다:

- **"11월 거래분"** → 현재 년도 11월로 추정
- **"지난달 거래"** → 이전 달로 추정 (향후 지원)
- **"올해 3월"** → 현재 년도 3월로 추정

**팁:** 자주 묻는 특정 날짜는 키워드에 직접 추가하는 것이 더 정확합니다.

---

## 검색 품질 향상 가이드 (Advanced)

### 1. 오타 방지 및 동의어 확장

사용자의 오타나 애매한 표현까지 잡아내려면 Synonyms에 자주 틀리는 오타도 포함시키세요:

```json
"synonyms": {
  "세금계산서": ["세계서", "계산서", "전자세금계산서", "전세계", "세금계산수", "세금계산"],
  "발급": ["발행", "작성", "만들기", "생성", "발굼", "발급방법"]
}
```

**팁:** 실제 사용자 질문 로그를 분석하여 자주 틀리는 오타를 동의어에 추가하세요.

### 2. 제외 키워드 (Negative Keywords) 활용

특정 단어가 들어갔을 때 절대 이 답변이 나오면 안 되는 경우를 정의합니다:

```json
{
  "id": "knowledge_tax_issuance",
  "type": "knowledge",
  "category": "세금계산서",
  "title": "세금계산서 발급 방법",
  "keywords": ["세금계산서", "발급", "방법", "어떻게"],
  "negativeKeywords": ["취소", "수정", "반품", "환입", "마이너스"],
  "priority": 5,
  "responses": {
    "formal": "..."
  }
}
```

**사용 예시:**
- 질문: "세금계산서 발급 말고 취소 알려줘"
- 결과: "발급 방법" 항목은 `negativeKeywords`에 "취소"가 있어 제외됨
- 대신 "수정세금계산서" 관련 항목이 매칭됨

### 3. 문맥 유지 (Context Awareness)

사용자가 연속된 질문을 할 때 이전 대화 맥락을 기억하도록 합니다.

**구현 방법:**
- 이전 질문의 `category`를 세션에 저장
- 다음 질문 검색 시 해당 카테고리 항목에 가산점 부여

**예시 시나리오:**
1. 사용자: "수정세금계산서 발급 방법은?"
2. 챗봇: "수정세금계산서는..." (category: "수정세금계산서" 저장)
3. 사용자: "그럼 기한은?"
4. 챗봇: "수정세금계산서" 카테고리 내 "기한" 관련 항목 우선 검색

---

## 답변 포맷팅 및 리치 콘텐츠 가이드

### 1. Markdown 문법 활용

답변의 가독성을 높이기 위해 Markdown 문법을 적극 활용하세요:

```json
{
  "responses": {
    "formal": "세금계산서 발급은 **[매출문서 작성]** 메뉴에서 가능합니다.\n\n**발급 절차:**\n1. 바로빌 로그인\n2. '세금계산서 발급' 메뉴 선택\n3. 공급받는자 정보 입력\n\n> ⚠️ **주의사항:** 발급 기한을 반드시 확인하세요.\n\n자세한 내용은 [발급 가이드](https://www.barobill.co.kr/guide/issue)를 참고하세요."
  }
}
```

**주요 문법:**
- **강조:** `**중요한 단어**` → **중요한 단어**
- **리스트:** `- 첫번째`, `1. 첫번째`
- **인용구:** `> 인용 내용`
- **링크:** `[텍스트](URL)`
- **코드:** `` `코드` ``

### 2. 동적 변수 (Dynamic Variables)

답변에 동적으로 변하는 값을 포함할 수 있습니다:

**지원 변수:**
- `{today}`: 오늘 날짜
- `{date}`: 질문에서 추출된 날짜
- `{deadline}`: 신고 마감일

**사용 예시:**
```json
{
  "responses": {
    "formal": "오늘({today}) 기준으로 부가세 신고 기한은 2025년 1월 25일까지입니다."
  }
}
```

### 3. 이미지 및 미디어 활용

복잡한 절차 설명 시 이미지를 활용하세요:

```json
{
  "responses": {
    "formal": "세금계산서 발급 절차:\n\n![발급 버튼 위치](https://www.barobill.co.kr/images/issue-button.png)\n\n위 이미지에서 [매출문서 작성] 버튼을 클릭하세요."
  }
}
```

### 4. 표(Table) 활용

복잡한 정보는 표로 정리하세요:

```json
{
  "responses": {
    "formal": "수정세금계산서 발급 사유:\n\n| 사유 | 작성일자 | 발급건수 |\n|------|----------|----------|\n| 기재사항착오정정 | 원본과 동일 | 2장 |\n| 이중발급 | 착오 인식일 | 1장 |\n| 환입 | 확인일 | 1장 |"
  }
}
```

---

## 피드백 기능 사용 가이드

### 사용자 피드백 제출

1. **메인 페이지 우측 패널**에서 "챗봇 개선 의견" 섹션 확인
2. 피드백 내용 입력
3. "의견 제출" 버튼 클릭
4. 전송 완료 메시지 확인

### 관리자 피드백 관리

1. **Admin 페이지 접근:**
   - `/admin` 경로로 직접 접근
   - 또는 브라우저 주소창에 `http://localhost:8080/admin` 입력

2. **피드백 관리 탭:**
   - "피드백 관리" 탭 클릭
   - 사용자 피드백 목록 확인

3. **피드백 조회:**
   - 작성일시 표시
   - 상태 표시 (대기중/검토완료)
   - 피드백 내용 확인

4. **피드백 삭제:**
   - 각 피드백 항목의 삭제 버튼 클릭
   - 확인 대화상자에서 "확인" 클릭

### 피드백 활용 방법

1. **정기적인 데이터 검토:**
   - 주기적으로 피드백 확인
   - 반복되는 문제점 파악

2. **지식베이스 개선:**
   - 피드백 내용을 바탕으로 키워드 보강
   - 답변 내용 개선
   - 새로운 항목 추가

3. **우선순위 조정:**
   - 자주 묻는 질문의 우선순위 상향 조정

---

## 엑셀 → JSON 변환 방식 검토 및 효율성 분석

### 현재 시스템 분석

#### 현재 워크플로우
1. **Admin 페이지 직접 입력** (현재 구현됨)
   - 웹 UI에서 직접 항목 추가/수정
   - 실시간 JSON 다운로드
   - 즉시 테스트 가능

2. **JSON 파일 직접 편집** (현재 가능)
   - 코드 에디터에서 직접 수정
   - Git으로 버전 관리
   - 개발자 친화적

3. **엑셀 → JSON 변환** (제안된 방식)
   - 기획자가 엑셀로 데이터 작성
   - Python 스크립트로 자동 변환
   - JSON 파일 생성

### 엑셀 → JSON 변환 방식의 장단점

#### ✅ 장점

1. **기획자 친화적**
   - 엑셀은 기획자에게 익숙한 도구
   - 복사/붙여넣기로 대량 데이터 입력 용이
   - 시트별로 데이터 분리 관리 가능

2. **대량 데이터 입력 효율적**
   - 여러 항목을 한 번에 작성 가능
   - 템플릿 재사용 가능
   - 데이터 검증 자동화 가능

3. **협업 용이**
   - 엑셀 파일 공유로 여러 명이 동시 작업 가능
   - 변경 이력 추적 가능 (엑셀 버전 관리)

#### ❌ 단점

1. **추가 도구 필요**
   - Python 환경 설정 필요
   - 변환 스크립트 실행 필요
   - 기술적 지식 필요

2. **워크플로우 복잡도 증가**
   - 엑셀 작성 → 변환 → JSON 확인 → 테스트
   - Admin 페이지보다 단계가 많음

3. **실시간 반영 어려움**
   - 변환 후 개발 서버 재시작 필요
   - 즉시 테스트 불가

### 현재 작업 방식과의 비교

| 항목 | Admin 페이지 | 엑셀 → JSON | JSON 직접 편집 |
|------|-------------|------------|---------------|
| **기획자 사용성** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| **개발자 사용성** | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **대량 입력** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| **실시간 테스트** | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |
| **버전 관리** | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **협업** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

### 효율성 검토 결과

#### 🎯 **현재 작업 방식이 효율적인 이유**

1. **Admin 페이지가 이미 구현됨**
   - 모든 필드 입력 가능 (negativeKeywords, dateTemplate, relatedGuides 포함)
   - 실시간 JSON 다운로드
   - 즉시 테스트 가능

2. **단순한 워크플로우**
   - Admin 페이지에서 입력 → 저장 → 다운로드 → 테스트
   - 추가 도구 불필요
   - 기술적 지식 최소화

3. **유연한 관리**
   - 항목별 개별 수정 용이
   - 실시간 반영
   - Git과 연동 가능

#### 📊 **엑셀 → JSON 변환 방식이 유용한 경우**

1. **대량 데이터 초기 구축**
   - 100개 이상의 항목을 한 번에 입력할 때
   - 기존 엑셀 데이터를 JSON으로 변환할 때

2. **기획팀 독립 작업**
   - 개발자 개입 없이 기획자가 직접 데이터 작성
   - 엑셀 파일로 검토 및 승인 프로세스 진행

3. **정기적인 대량 업데이트**
   - 분기별 대량 업데이트
   - 외부 데이터 소스와 연동

### 권장 워크플로우

#### 시나리오별 추천 방식

**1. 소량 추가/수정 (1-10개 항목)**
```
✅ Admin 페이지 사용 (권장)
→ 즉시 입력 → 테스트 → 완료
```

**2. 중량 추가/수정 (10-50개 항목)**
```
✅ Admin 페이지 사용 (권장)
→ 또는 JSON 직접 편집
```

**3. 대량 초기 구축 (50개 이상)**
```
✅ 엑셀 → JSON 변환 (권장)
→ 엑셀로 작성 → 변환 → 검증 → 통합
```

**4. 정기적 대량 업데이트**
```
✅ 엑셀 → JSON 변환 (권장)
→ 템플릿 재사용 → 자동화 가능
```

### 결론 및 권장사항

#### 현재 작업 방식 (Admin 페이지)이 효율적인 이유

1. **즉시성**: 입력 즉시 테스트 가능
2. **단순성**: 추가 도구 불필요
3. **완전성**: 모든 필드 지원 (최신 업데이트 완료)
4. **유연성**: 항목별 개별 관리 용이

#### 엑셀 → JSON 변환 방식 활용 시점

- ✅ **대량 초기 구축** 시 활용
- ✅ **기획팀 독립 작업** 필요 시 활용
- ✅ **정기적 대량 업데이트** 시 활용
- ❌ **일반적인 추가/수정**에는 Admin 페이지 권장

#### 하이브리드 접근법 (최적)

```
일반 작업: Admin 페이지 사용
대량 작업: 엑셀 → JSON 변환 사용
최종 검증: Admin 페이지에서 확인
```

이 방식으로 **유연성**과 **효율성**을 모두 확보할 수 있습니다.

---

## 전문적인 답변 작성 가이드

### 세무/세금계산서 전문성 확보 전략

바로빌 챗봇은 세금계산서 발급 서비스를 제공하는 전문 플랫폼이므로, 답변에 법적 근거, 가산세 정보, 주의사항 등을 자연스럽게 포함해야 합니다.

#### 1. 법적 정보 통합 방법

**❌ 별도 필드로 분리하지 않음**
```json
// 잘못된 예시
{
  "legal": "부가가치세법 시행령 제57조",
  "disclaimer": "신고 기간 내 발급 필요"
}
```

**✅ 답변 텍스트에 자연스럽게 포함**
```json
{
  "responses": {
    "formal": "세금계산서 발급 관련 가산세:\n\n【발급 가산세】\n• 미발급: 공급가액의 2% (부가가치세법 시행령 제57조)\n• 지연발급: 공급가액의 1%\n\n【발급 기한】\n• 공급일이 속하는 달의 다음 달 10일까지 발급\n• 기한 내 미발급 시 가산세 부과\n\n기한을 준수하여 가산세를 방지하시기 바랍니다."
  }
}
```

#### 2. 가산세 정보 포함 전략

**포함해야 할 정보:**
- 가산세율 (미발급, 지연발급, 미전송, 지연전송)
- 발급/전송 기한
- 법적 근거 (필요 시)

**예시:**
```json
{
  "id": "knowledge_penalty",
  "type": "knowledge",
  "category": "세무정보",
  "title": "세금계산서 발급 가산세",
  "keywords": ["가산세", "지연발급", "미발급", "지연전송", "미전송", "페널티"],
  "priority": 6,
  "responses": {
    "formal": "세금계산서 발급 관련 가산세:\n\n【발급 가산세】\n• 미발급: 공급가액의 2%\n• 지연발급: 공급가액의 1%\n\n【전송 가산세】\n• 미전송: 공급가액의 0.5%\n• 지연전송: 공급가액의 0.3%\n\n【발급 기한】\n• 공급일이 속하는 달의 다음 달 10일까지 발급\n• 발급일 다음 날까지 국세청 전송\n\n기한을 준수하여 가산세를 방지하시기 바랍니다.",
    "casual": "가산세:\n• 미발급: 2%\n• 지연발급: 1%\n• 미전송: 0.5%\n• 지연전송: 0.3%\n\n발급은 다음 달 10일까지, 전송은 발급 다음 날까지!",
    "plain": "세금계산서 미발급 시 2%, 지연발급 시 1%, 미전송 시 0.5%, 지연전송 시 0.3% 가산세가 부과됩니다."
  }
}
```

#### 3. 주의사항 및 예외 상황 안내

**포함 방법:**
- `【주의사항】` 섹션으로 구분
- `⚠️` 이모지로 시각적 강조
- 예외 상황 명시

**예시:**
```json
{
  "responses": {
    "formal": "바로빌 인증서 등록 방법:\n\n【등록 절차】\n1. 바로빌 로그인\n2. '환경설정' 또는 '인증서 관리' 메뉴 선택\n...\n\n【주의사항】\n• 사업자 명의의 인증서만 등록 가능\n• 유효기간 만료 전 갱신 필요\n• 인증서 갱신 후 재등록 필요"
  }
}
```

#### 4. 날짜 기반 상황별 대응

**dateTemplate 활용:**
- 날짜가 포함된 질문은 `dateTemplate: true` 사용
- `{date}`, `{deadline}` 동적 변수 활용
- 신고 마감일 자동 계산

**예시:**
```json
{
  "id": "case_return_date_template",
  "type": "case",
  "category": "수정세금계산서",
  "title": "특정 날짜 거래분 반품 처리",
  "dateTemplate": true,
  "priority": 9,
  "responses": {
    "formal": "{date}자 세금계산서의 경우, 해당 세금 신고 마감기한({deadline})이 지나지 않았다면 [환입] 사유로 수정세금계산서를 발행하시면 됩니다.\n\n수정세금계산서 메뉴에서 '환입(반품)' 사유를 선택하시고, 반품된 금액만큼 입력하시면 자동으로 마이너스(-) 세금계산서가 발행됩니다.\n\n⚠️ **주의**: 신고 마감기한이 지난 경우 가산세가 부과될 수 있습니다."
  }
}
```

#### 5. 수정세금계산서 6대 사유 상세 안내

**각 사유별 필수 정보:**
- 수정 사유명
- 작성일자 규칙
- 발급 건수
- 금액 입력 방법

**예시:**
```json
{
  "id": "case_modify_error",
  "type": "case",
  "category": "수정세금계산서",
  "title": "기재사항 착오 정정",
  "keywords": ["착오정정", "기재사항", "오류", "오타", "정정"],
  "priority": 8,
  "responses": {
    "formal": "기재사항에 착오가 있어 정정하는 경우:\n\n【수정 사유】 기재사항착오정정\n【작성일자】 원본과 동일 (변경 불가)\n【발급 건수】 2장 (취소분 + 정정분)\n【금액 입력】\n  - 취소분: 원본 전액 부(-)\n  - 정정분: 올바른 내용으로 정(+)\n\n시스템이 자동으로 2장을 생성합니다."
  }
}
```

#### 6. 관련 가이드 및 추가 정보 제공

**relatedGuides 활용:**
- 상세 가이드 링크
- 동영상 강좌
- 블로그 포스트

**예시:**
```json
{
  "relatedGuides": [
    {
      "title": "취소(수정)세금계산서 상세 가이드",
      "url": "https://www.barobill.co.kr/blog/취소세금계산서",
      "icon": "🔗"
    },
    {
      "title": "수정발급 동영상 강좌",
      "url": "https://www.barobill.co.kr/video/guide",
      "icon": "📺"
    }
  ]
}
```

#### 7. 답변 작성 체크리스트

**✅ 필수 확인 사항:**
- [ ] 법적 근거가 필요한 경우 답변에 포함
- [ ] 가산세 정보가 정확한가?
- [ ] 주의사항이 명확한가?
- [ ] 날짜 기반 질문은 `dateTemplate: true` 사용
- [ ] 관련 가이드 링크가 유효한가?
- [ ] 어투별 답변이 자연스러운가?
- [ ] Markdown 형식이 올바른가? (`**강조**`, `【섹션】`)

**✅ 전문성 확보:**
- [ ] 세무 용어가 정확한가?
- [ ] 법령 근거가 명시되어 있는가? (필요 시)
- [ ] 예외 상황이 고려되었는가?
- [ ] 사용자가 혼동할 수 있는 부분이 명확한가?

#### 8. 현재 구조의 장점 (최종 정리)

**✅ 자동화된 날짜 처리**
- `dateTemplate: true` + `date-utils.ts`로 모든 날짜 자동 계산
- 기획자가 마감일을 수동 계산할 필요 없음
- 365일 모든 날짜 대응 가능

**✅ 유연한 답변 구조**
- 법적 정보, 가산세, 주의사항을 답변 텍스트에 자연스럽게 포함
- 별도 필드 관리 불필요
- 뉘앙스 조정 용이

**✅ 정확한 매칭**
- `priority` + `negativeKeywords` + `type` 조합
- 상황별 정확한 답변 제공

**✅ 관리 효율성**
- Admin 페이지로 직관적 관리
- Excel → JSON 변환으로 대량 작업 가능
- 하이브리드 접근법으로 유연성 확보

---

## 질문 리스트 기반 데이터 추가 가이드

### Excel 질문 리스트 활용 방법

1. **Excel 파일 확인**
   - `refrence/챗봇 질문리스트/바로빌 챗봇_질문 리스트업.xlsx` 파일 열기
   - 질문 목록과 카테고리 확인

2. **Type 구분 기준**
   - **intent**: 인사, 자기소개 등 기본 대화
   - **knowledge**: 일반 지식 (발급 방법, 신고 기한 등)
   - **case**: 상황별 사례 (반품, 착오정정 등)
   - **faq**: 자주 묻는 질문 (FAQ JSON으로 분리 권장)
   - **error**: 오류 해결 (에러 메시지 대응)

3. **데이터 추가 절차**
   - Excel의 질문을 type별로 분류
   - `barobill-knowledge-example.json` 참고하여 형식 맞추기
   - Admin 페이지 또는 직접 JSON 편집으로 추가
   - 테스트 후 배포

### Example 파일 활용 방법

`src/data/barobill-knowledge-example.json` 파일은 실제 `barobill-knowledge.json`에 항목을 추가하기 위한 **템플릿 모음**입니다.

**사용 방법:**
1. `barobill-knowledge-example.json` 파일 열기
2. 필요한 type의 예시 항목 복사
3. `barobill-knowledge.json`의 `items` 배열에 붙여넣기
4. `id`, `title`, `keywords`, `responses` 등 내용 수정
5. Admin 페이지에서 테스트 또는 직접 검증

**주의사항:**
- Example 파일은 참고용이므로 실제 챗봇에서 사용되지 않습니다
- 복사 후 반드시 내용을 실제 질문/답변에 맞게 수정해야 합니다
- `id`는 고유해야 하므로 기존 항목과 중복되지 않도록 주의

---

## 개선점 및 향후 계획

### 현재 구현된 기능

✅ 기본 키워드 매칭 및 동의어 확장  
✅ 우선순위 기반 점수 계산  
✅ 날짜 패턴 자동 추출  
✅ 신고 마감일 자동 계산  
✅ 동적 변수 치환 ({date}, {deadline}, {today})  
✅ Negative Keywords 필터링  
✅ 피드백 수집 및 관리  
✅ Markdown 기본 지원  

### 향후 개선 계획

#### 1. 검색 품질 향상
- [ ] Fuzzy Matching (오타 보정) - Levenshtein Distance 알고리즘
- [ ] Context Awareness (문맥 유지) - 이전 대화 맥락 기억
- [ ] 자모 단위 분해를 통한 오타 보정

#### 2. 답변 품질 향상
- [ ] Markdown 완전 지원 (이미지, 표 렌더링)
- [ ] Rich Text 확장 (이미지, 동영상)
- [ ] 피드백 루프 (👍/👎) 버튼 추가

#### 3. 날짜 처리 개선
- [ ] 상대적 날짜 처리 ("오늘", "어제", "지난주")
- [ ] 날짜 범위 처리 ("11월 1일부터 20일까지")
- [ ] 공휴일 자동 계산

#### 4. 사용자 경험 개선
- [ ] 대화 내보내기 기능 (텍스트/PDF)
- [ ] 대화 기록 저장
- [ ] 즐겨찾기 질문 기능

#### 5. 관리 기능 강화
- [ ] 피드백 통계 대시보드
- [ ] 자주 묻는 질문 분석
- [ ] 키워드 효과 분석

